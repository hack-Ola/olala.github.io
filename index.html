<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ola Cards PRO</title>

<style>
body{
margin:0;
font-family:'Segoe UI';
background:linear-gradient(135deg,#1e3c72,#2a5298);
color:white;
text-align:center;
}

h1{
margin:20px;
font-size:28px;
}

#loginBox{
margin:20px;
}

input{
padding:10px;
border-radius:8px;
border:none;
width:200px;
}

button{
padding:10px 18px;
border:none;
border-radius:8px;
background:#ffcc00;
font-weight:bold;
cursor:pointer;
margin:5px;
}

#game-board{
display:grid;
gap:15px;
padding:20px;
max-width:900px;
margin:auto;
}

@media(max-width:768px){
#game-board{grid-template-columns:repeat(3,1fr);}
}
@media(min-width:769px){
#game-board{grid-template-columns:repeat(4,1fr);}
}

.card{
aspect-ratio:3/4;
perspective:1200px;
}

.card-inner{
width:100%;
height:100%;
position:relative;
transform-style:preserve-3d;
transition:transform 0.6s;
}

.card.flipped .card-inner{
transform:rotateY(180deg);
}

.card-front,.card-back{
position:absolute;
width:100%;
height:100%;
backface-visibility:hidden;
border-radius:15px;
overflow:hidden;
}

.card-front{
background:#ffcc00;
display:flex;
align-items:center;
justify-content:center;
font-size:22px;
font-weight:bold;
}

.card-back{
transform:rotateY(180deg);
background:white;
}

.card-back img{
width:100%;
height:100%;
object-fit:cover;
}

#playersList{
margin-top:10px;
}

#turnInfo{
margin-top:10px;
font-weight:bold;
}

#winnerBox{
font-size:22px;
margin-top:15px;
color:#ffeb3b;
}
</style>
</head>

<body>

<h1> Ola Cards-Ø¬Ù…Ø±Ø© ØºØ¶Ù‰</h1>

<div id="loginBox">
<input type="text" id="playerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
<button onclick="joinGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="turnInfo"></div>
<div id="playersList"></div>
<div id="winnerBox"></div>
<button onclick="restartGame()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</button>

<div id="game-board"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
apiKey:"AIzaSyD6uCfq2o4zaimOqjz-_tVkukpgLp7rZIQ",
authDomain:"ola-cards.firebaseapp.com",
databaseURL:"https://ola-cards-default-rtdb.firebaseio.com",
projectId:"ola-cards",
storageBucket:"ola-cards.firebasestorage.app",
messagingSenderId:"40775529581",
appId:"1:40775529581:web:8040ea60cba212401afb64"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let myId=null;
let flippedLocal=[];
let gameStarted=false;

const images=[
"https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=400",
"https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=400",
"https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?w=400",
"https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=400",
"https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400",
"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400"
];

function createGame(){
let cards=[...images,...images];
cards.sort(()=>0.5-Math.random());

db.ref("room").set({
cards:cards.map(c=>({value:c,flipped:false,matched:false})),
turn:0,
players:{},
gameOver:false
});
}

db.ref("room").once("value",snap=>{
if(!snap.exists()) createGame();
});

function joinGame(){
if(gameStarted) return alert("Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„");

const name=document.getElementById("playerName").value;
if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");

myId=db.ref("room/players").push({name:name,score:0}).key;
document.getElementById("loginBox").style.display="none";
}

db.ref("room").on("value",snap=>{
const data=snap.val();
if(!data) return;

updatePlayers(data.players,data.turn);
renderBoard(data.cards,data.turn,data.gameOver);
checkGameEnd(data);
});

function updatePlayers(players,turn){
let html="";
let ids=Object.keys(players||{});

if(ids.length>0) gameStarted=true;

ids.forEach((id,i)=>{
html+=`<div>${players[id].name} : ${players[id].score}</div>`;
if(i===turn){
document.getElementById("turnInfo").innerHTML=
"ğŸ¯ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ: "+players[id].name;
}
});

document.getElementById("playersList").innerHTML=html;
}

function renderBoard(cards,turn,gameOver){
const board=document.getElementById("game-board");
board.innerHTML="";

cards.forEach((card,i)=>{
let div=document.createElement("div");
div.className="card"+(card.flipped||card.matched?" flipped":"");

div.innerHTML=`
<div class="card-inner">
<div class="card-front">Ola</div>
<div class="card-back">
<img src="${card.value}">
</div>
</div>`;

div.onclick=()=>flipCard(i,cards,turn,gameOver);
board.appendChild(div);
});
}

function flipCard(index,cards,turn,gameOver){
if(!myId||gameOver) return;

db.ref("room/players").once("value").then(pSnap=>{
const ids=Object.keys(pSnap.val());
if(ids[turn]!==myId) return;

if(cards[index].flipped||cards[index].matched) return;

db.ref("room/cards/"+index).update({flipped:true});
flippedLocal.push(index);

if(flippedLocal.length===2){
setTimeout(()=>checkMatch(ids,turn),700);
}
});
}

function checkMatch(ids,turn){

    db.ref("room/cards").once("value").then(snap=>{

        const cards = snap.val();
        let [a,b] = flippedLocal;

        if(!cards[a] || !cards[b]) return;

        if(cards[a].value === cards[b].value){

            db.ref("room/cards/"+a).update({
                matched:true,
                flipped:true
            });

            db.ref("room/cards/"+b).update({
                matched:true,
                flipped:true
            });

            db.ref("room/players/"+ids[turn]+"/score")
            .transaction(score => (score||0) + 1);

        }else{

            db.ref("room/cards/"+a).update({flipped:false});
            db.ref("room/cards/"+b).update({flipped:false});

            db.ref("room").update({
                turn:(turn+1) % ids.length
            });
        }

        flippedLocal=[];

        // ğŸ”¥ ÙØ­Øµ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
        setTimeout(checkGameEnd, 1000);

    });
}


let message="";
if(winners.length===1){
message="ğŸ† Ø§Ù„ÙØ§Ø¦Ø²: "+winners[0];
}else{
message="ğŸ¤ ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ†: "+winners.join(" Ùˆ ");
}

document.getElementById("winnerBox").innerHTML=message;
db.ref("room").update({gameOver:true});
}

function restartGame(){
createGame();
document.getElementById("winnerBox").innerHTML="";
}
</script>
</body>
</html>
