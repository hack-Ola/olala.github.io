<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ola Cards</title>

<style>
body{
margin:0;
font-family:'Segoe UI';
background:linear-gradient(135deg,#1e3c72,#2a5298);
color:white;
text-align:center;
}
h1{margin:20px;}
input,select{
padding:8px;
border-radius:6px;
border:none;
margin:5px;
}
button{
padding:8px 15px;
border:none;
border-radius:6px;
background:#ffcc00;
font-weight:bold;
cursor:pointer;
margin:5px;
}
#game-board{
display:grid;
gap:15px;
padding:20px;
max-width:1000px;
margin:auto;
}
@media(max-width:768px){
#game-board{grid-template-columns:repeat(3,1fr);}
}
@media(min-width:769px){
#game-board{grid-template-columns:repeat(4,1fr);}
}
.card{
aspect-ratio:3/4;
perspective:1200px;
}
.card-inner{
width:100%;
height:100%;
position:relative;
transform-style:preserve-3d;
transition:transform 0.6s;
}
.card.flipped .card-inner{
transform:rotateY(180deg);
}
.card-front,.card-back{
position:absolute;
width:100%;
height:100%;
backface-visibility:hidden;
border-radius:14px;
overflow:hidden;
}
.card-front{
background:#ffcc00;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
font-size:22px;
}
.card-back{
transform:rotateY(180deg);
background:white;
}
.card-back img{
width:100%;
height:100%;
object-fit:cover;
}
</style>
</head>

<body>

<h1> Ola Cards-Ø¬Ù…Ø±Ø© ØºØ¶Ù‰ </h1>

<div id="loginBox">
<input type="text" id="playerName" placeholder="Ø§Ø³Ù…Ùƒ">
<select id="difficulty">
<option value="6">Ø³Ù‡Ù„</option>
<option value="8">Ù…ØªÙˆØ³Ø·</option>
<option value="10">ØµØ¹Ø¨</option>
<option value="12">Ù…Ø­ØªØ±Ù</option>
</select>
<button onclick="joinGame()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="startNewGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
</div>

<div id="turnInfo"></div>
<div id="playersList"></div>
<div id="game-board"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
apiKey:"YOUR_KEY",
authDomain:"ola-cards.firebaseapp.com",
databaseURL:"https://ola-cards-default-rtdb.firebaseio.com",
projectId:"ola-cards"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let myId=null;
let flippedLocal=[];
let playersOrder=[];

const images=[
"https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=400",
"https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=400",
"https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?w=400",
"https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=400",
"https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400",
"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400",
"https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=400",
"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=400",
"https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=400",
"https://images.unsplash.com/photo-1526481280691-7819c8d9f3e6?w=400",
"https://images.unsplash.com/photo-1482192505345-5655af888cc4?w=400",
"https://images.unsplash.com/photo-1499856871958-5b9627545d1a?w=400"
];

function createGame(level){
let selected=images.slice(0,level);
let cards=[...selected,...selected];
cards.sort(()=>0.5-Math.random());
db.ref("room").set({
cards:cards.map(c=>({value:c,flipped:false,matched:false})),
turn:0,
players:{},
gameOver:false,
result:null
});
}

function startNewGame(){
const level=parseInt(document.getElementById("difficulty").value);
db.ref("room").remove().then(()=>{
createGame(level);
});
}

function joinGame(){
const name=document.getElementById("playerName").value;
if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");

db.ref("room").once("value").then(snap=>{
if(!snap.exists()){
createGame(parseInt(document.getElementById("difficulty").value));
}
});

const ref=db.ref("room/players").push({name:name,score:0});
myId=ref.key;
document.getElementById("loginBox").style.display="none";
}

db.ref("room").on("value",snap=>{
const data=snap.val();
if(!data) return;

playersOrder=Object.keys(data.players||{});
updatePlayers(data.players,data.turn);
renderBoard(data.cards);

if(data.gameOver && data.result){
alert(data.result);
}
});

function updatePlayers(players,turn){
let html="";
playersOrder.forEach((id,i)=>{
html+=`<div>${players[id].name} : ${players[id].score}</div>`;
if(i===turn){
document.getElementById("turnInfo").innerHTML=
"ğŸ¯ Ø§Ù„Ø¯ÙˆØ±: "+players[id].name;
}
});
document.getElementById("playersList").innerHTML=html;
}

function renderBoard(cards){
const board=document.getElementById("game-board");
board.innerHTML="";
cards.forEach((card,i)=>{
const div=document.createElement("div");
div.className="card"+(card.flipped||card.matched?" flipped":"");
div.innerHTML=`
<div class="card-inner">
<div class="card-front">Ola</div>
<div class="card-back">
<img src="${card.value}">
</div>
</div>`;
div.onclick=()=>handleFlip(i);
board.appendChild(div);
});
}

function handleFlip(index){
if(!myId) return;
db.ref("room").once("value").then(snap=>{
const data=snap.val();
if(data.gameOver) return;
const cards=data.cards;
const turn=data.turn;
if(playersOrder[turn]!==myId) return;
if(cards[index].flipped||cards[index].matched) return;
db.ref("room/cards/"+index).update({flipped:true});
flippedLocal.push(index);
if(flippedLocal.length===2){
setTimeout(checkMatch,700);
}
});
}

function checkMatch(){
db.ref("room").once("value").then(snap=>{
const data=snap.val();
const cards=data.cards;
const turn=data.turn;
let[a,b]=flippedLocal;

if(cards[a].value===cards[b].value){
db.ref("room/cards/"+a).update({matched:true});
db.ref("room/cards/"+b).update({matched:true});
db.ref("room/players/"+playersOrder[turn]+"/score")
.transaction(s=>(s||0)+1);
}else{
db.ref("room/cards/"+a).update({flipped:false});
db.ref("room/cards/"+b).update({flipped:false});
db.ref("room").update({turn:(turn+1)%playersOrder.length});
}

flippedLocal=[];
setTimeout(checkGameEnd,800);
});
}

function checkGameEnd(){
db.ref("room").once("value").then(snap=>{
const data=snap.val();
const finished=data.cards.every(c=>c.matched);
if(!finished) return;

let max=0;
let winners=[];
Object.values(data.players).forEach(p=>{
if(p.score>max) max=p.score;
});
Object.values(data.players).forEach(p=>{
if(p.score===max) winners.push(p.name);
});

let message=winners.length===1?
"ğŸ† Ø§Ù„ÙØ§Ø¦Ø²: "+winners[0]:
"ğŸ¤ ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ†: "+winners.join(" Ùˆ ");

db.ref("room").update({
gameOver:true,
result:message
});
});
}
</script>
</body>
</html>
